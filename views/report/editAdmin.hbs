<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<div class="logolaudo">
  <img src="/images/logolaudo.jpg">
</div>
<p></p>
<div class="title-laudo">
  <h3>
    <u> Laudo de Análise Micotoxicológica </u>
  </h3>
</div>
<div class="laudo-text">
  <h4> <b>Registro Lab.</b> MICOTOX {{Requisitiondata.requisitionnumber}}/{{Requisitiondata.year}}</h4>
  <h4> <b>1. Laudo n°:</b> {{sample.samplenumber}}/{{Requisitiondata.year}}</h4>
  <h4> <b>2. Descrição da Amostra:</b> </h4>
  <div class="info-laudo">
    <h4> 2.1 - Tipo de embalagem: {{Requisitiondata.packingtype}} </h4>
    <h4> 2.2 - Quantidade recebida: {{Requisitiondata.receivedquantity}}</h4>
    <h4> 2.3 - Produtor: {{Requisitiondata.producer}}</h4>
    <div class="laudo-linha row">
      <h4 class="mr-5"> 2.4 - Data de recebimento: {{Requisitiondata.datereceipt}}</h4>
      <h4> N° autorização: {{Requisitiondata.autorizationnumber}}</h4>
    </div>
  </div>
  <h4> <b>3. Descrição da empresa pública ou privada/pessoa física/pessoa jurídica solicitante:</b> </h4>
  <div class="info-laudo">
    <h4> 3.1 - Nome: {{Requisitiondata.clientName}}</h4>
    <h4> 3.2 - Responsável pela entrega da amostra: {{Requisitiondata.responsible}} </h4>
  </div>
  <h4> <b>4. Características das análises da amostra:</b> </h4>
  <div class="info-laudo">
    <h4> 4.1 - Detecção e quantificação de {{Requisitiondata.toxinas}} </h4>
  </div>
  <h4> <b>5. Resultados:</b> </h4>
  <form action="/report/show/admin/{{sample._id}}" method="post">
    <div class="info-laudo">
      <table class="table text-center">
        <caption>ND = Não Detectado *média de duas repetições </caption>
        <thead>
          <tr class="text-center">
            <th scope="col">Micotoxinas</th>
            <th scope="col" class="text-center">Concentração Detectada (ppb)* </th>
            <th scope="col" class="text-center">Limite de Detecção -LoD (ppb) </th>
            <th scope="col" class="text-center">Limite de Quantificação - LoQ (ppb)</th>
          </tr>
        </thead>
        <tbody>
          {{#each toxinaData.Values}}
            <tr>
              <th scope="row">{{Name}}</th>
              <td>
                <input type="text" id="{{Pair.name}}Conc" value="{{round Result 2}}">
                <input type="checkbox" id="{{Pair.name}}Check" name="toxinaCheck" value="{{Name}}">
              </td>
              <td>{{Pair.kit.Lod}}</td>
              <td>{{Pair.kit.Loq}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
      <div>
        <input type="checkbox" id="allCheck" value="checked">
        <label for="allCheck">Todas as toxinas passaram</label><br>
      </div>
    </div>
    <h4> 6. Parecer técnico: </h4>
    <textarea id="parecer" name="sample[parecer]" class="col-sm-12" readonly></textarea>
    <h4> 7. Comentários: </h4>
    <textarea name="sample[description]" cols="100" rows="7">{{sample.description}}</textarea>
    <br><button type="submit">Atualizar</button>
  </form>
  <h4> Belo Horizonte, </h4>
  <div class="laudo-assinatura">
    <p><u> _________________________________ </u></p>
    <p>Profa Dra Kelly Moura Keller</p>
    <p>DMVP/EV-UFMG</p>
    <p>Coordenadora LAMICO</p>
  </div>

  <div class="laudo-footer page-footer font small">
    <h7 class="text-uppercase">Av. Antônio Carlos 6627 - Escola de Veterinária da UFMG - Belo Horizonte / MG - CEP
      31270-901 - www.lamico.com.br</h7>
    <p>Tels.: +55 (31) 3409-2098 Sala / 3409-2113 ou 2115 Lab. / Cel.: 98585-4965 Claro - Email: kelly.medvet@gmail.com
    </p>
  </div>
  <center>
    <button class="btn btn-primary hidden-print" onclick="location.href='/report/admreport'"><span class="glyphicon"
        aria-hidden="true"></span> Voltar </button>
  </center>
</div>

<script>
  $(document).ready(function () {
    var countChecked = function () {
      const ToxinasLower = ['aflatoxina', 'deoxinivalenol', 'fumonisina', 'ocratoxina', 't2toxina', 'zearalenona'];
      const ToxinasFormal = ['Aflatoxinas', 'Deoxinivalenol', 'Fumonisinas', 'Ocratoxina A', 'T-2 toxina', 'Zearalenona'];
      var n = $('input[name="toxinaCheck"]:checked').length;
      //var nTotal = $('input[name="toxinaCheck"]').length;
      var listNames = [];
      var idName = {};
      var frase = "";
      var inicio = ""
      var fraseCompleta = "*inicio* a presença de *frase* na amostra analisada. O resultado da análise restringe-se tão somente à amostra analisada."

      // $('#allCheck').prop("checked", n === nTotal);

      $('input[name="toxinaCheck"]:checked').each(function () {
        listNames.push($(this).val());
      });

      if (n > 0) { //Pedaço que analiza o vetor de nomes e escreve apropriadamente.
        if (listNames.length > 2) {
          for (i = 0; i < listNames.length - 2; i++) {
            frase = frase + " " + listNames[i] + ",";
          }
          frase = frase + " " + listNames[listNames.length - 2];
          frase = frase + " e " + listNames[listNames.length - 1];
          inicio = "Foram detectadas";
        } else if (listNames.length == 1) {
          frase = frase + listNames[0];
          inicio = "Foi detectada";
        } else {
          for (i = 0; i < listNames.length - 1; i++) {
            frase = frase + " " + listNames[i];
          }
          frase = frase + " e " + listNames[listNames.length - 1];
          inicio = "Foram detectadas";
        }
        fraseCompleta = fraseCompleta.replace("*frase*", frase);
        fraseCompleta = fraseCompleta.replace("*inicio*", inicio);
        $("#parecer").text(fraseCompleta);
      } else {
        $("#parecer").text("Não foi detectada a presença de nenhuma toxina na amostra analisada. O resultado da análise restringe-se tão somente à amostra analisada.");
      }
    };
    countChecked();
    $("input[type=checkbox][name=toxinaCheck]").change(countChecked);

    var checkAll = function () {
      $('input[type=checkbox][name="toxinaCheck"]').each(function () {
        $(this).prop("checked", $("#allCheck").is(":checked"));
        countChecked();
      });
    }
    $("#allCheck").change(checkAll);
  })
</script>

<script src="/javascripts/report.js"></script>